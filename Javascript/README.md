# Javascript

- [실행 컨텍스트](#실행-컨텍스트-execution-context)
- [Dom, 가상 Dom]()
- [이벤트 버블링, 이벤트 캡쳐링]()

* URL 을 입력하고 벌어지는 일
* 브라우저의 동작 원리
* 깊은 복사와 얕은 복사(https://medium.com/watcha/%EA%B9%8A%EC%9D%80-%EB%B3%B5%EC%82%AC%EC%99%80-%EC%96%95%EC%9D%80-%EB%B3%B5%EC%82%AC%EC%97%90-%EB%8C%80%ED%95%9C-%EC%8B%AC%EB%8F%84%EC%9E%88%EB%8A%94-%EC%9D%B4%EC%95%BC%EA%B8%B0-2f7d797e008a)

## 실행 컨텍스트 (Execution Context)

> 실행 컨텍스트를 바르게 이해하면<br> 자바스크립트가 스코프를 기반으로 식별자와 식별자에 바인딩된 값을 관리하는 방식과 호이스팅이 발생하는 이유, 클로저의 동작 방식, 그리고 태스크 큐와 함께 동작하는 이벤트 핸들러와 비동기 처리의 동작 방식을 이해할 수 있다.

### 1 실행 컨텍스트란?

- 코드를 <b>실행</b>하는데 필요한 <b>환경</b>을 제공하는 객체
- 동일한 환경에 있는 코드들을 실행 시, 필요한 환경 정보를 모아 컨텍스트를 구성하고, 이를 콜 스택에 쌓아 올렸다가, <b>가장 위에 쌓여있는 컨텍스트와 코드를 실행하는 방식</b>으로 <b>전체 코드의 환경과 순서를 보장</b>합니다.

ECMAScript 사양은 소스코드를 4가지로 구분한다.<br>
소스코드(실행 가능한 코드 excutable code)를 4가지 타입으로 구분하는 이유는 소스코드의 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이 다르기 때문이다.

| 소스코드의 타입             | 설명                                                                                                      |
| --------------------------- | --------------------------------------------------------------------------------------------------------- |
| `global code` (전역 코드)   | 전역에 존재하는 소스코드를 말한다. 전역에 정의된 함수, 클래스 등의 내부 코드는 포함되지 않는다.           |
| `function code` (함수 코드) | 함수 내부에 존재하는 소스코드를 말한다. 함수 내부에 중첩된 함수, 클래스 등의 내부 코드는 포함되지 않는다. |
| `eval code` (eval 코드)     | 빌트인 전역 함수인 eval 함수에 인수로 전달되어 실행되는 소스코드를 말한다.                                |
| `module code` (모듈 코드)   | 모듈 내부에 존재하는 소스코드를 말한다. 모듈 내부의 함수, 클래스 등의 내부 코드는 포함되지 않는다.        |

- 전역 코드
  - 전역 코드는 전역 변수를 관리하기 위해 최상위 스코프인 전역 스코프를 생성해야 한다.
  - 그리고 var 키워드로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수를 전역 객체의 프로퍼티와 메서드로 바인딩하고 참조하기 위해 전역 객체와 연결되어야 한다.
  - 이를 위해 전역 코드가 평가되면 전역 실행 컨텍스트가 생성된다.
- 함수 코드
  - 함수 코드는 지역 스코프를 생성하고 지역 변수, 매개변수, arguments 객체를 관리해야 한다.
  - 그리고 생성한 지역 스코프를 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결해야 한다.
  - 이를 위해 함수 코드가 평가되면 함수 실행 컨텍스트가 생성된다.

### 2 소스코드의 평가와 실행

자바스크립트 엔진은 소스코드를 2개의 과정으로 나누어 처리한다.

1. 소스코드의 평가
1. 소스코드의 실행

### 3 실행 순서와 Execution Stack

엔진이 스크립트 파일을 실행하기 전에 `글로벌 실행 컨텍스트(Global Execution Context)`가 생성되고, 함수를 호출할 때마다 `함수 실행 컨텍스트(Function Excution Context, FEC)`가 생성됩니다.<br>
그렇게 때문에 글로벌 컨텍스트는 한 프로그램에 한 개만 존재하게 됩니다.

> 글로벌 생성 -> 스크립트 파일 생성 -> 함수 호출 -> 함수 생성 -> 함수실행 종료 -> 함수 제거 -> 모든 코드 실행 종료 -> 글로벌 제거

JS의 Excution stack은 LIFO(후입 선출법 last-in, first-out) 구조로 이뤄져 있습니다. 왜냐면 JS는 싱글 스레드이기 때문에 여러 일을 동시에 처리할 수 없기 때문이다.

![실행 순서와 Execution Stack](https://miro.medium.com/max/700/1*dUl6qPEaDJJTXWythQsEtQ.gif)

그래서 맨 위의 컨텍스트가 실행이 완료되어 사라진 뒤에야 그 다음의 컨텍스트가 실행될 수 있습니다.

### 4 실행 컨텍스트의 구조

실행 컨텍스트는 세 가지 구조로 이루어져 있습니다.

1. This Binding
1. Laxical Environment
1. Variable Environment

### 4.1 This Binding

- this는 자신을 불러온 객체를 가르킵니다.
- 실행 컨텍스트 활성화 당시, this가 지정되지 않은 경우(자신을 불러온 객체가 없는 경우) this에는 전역 객체가 저장됩니다.
- 하지만 arrow function을 사용하게 되면, 부모의 객체를 가르키게 됩니다.

### 4.2 Lexical Environment

### 4.2.1 Environment Record

- 식별자들을 연관된 렉시컬 환경 범위 안의 값들 맵핑시켜주는 구조
- `let` 과 `const`으로 선언된 식별자들의 값을 보관하는 곳입니다.

### 4.2.2 Outer Reference

- 부모 렉시컬 환경의 참조값을 갖고 있습니다.
- = JS 엔진이 최근 렉시컬 환경을 찾지 못하면 외부 환경의 내부에 있는 변수를 볼 수 있도록 해줍니다.
- `global context` : outer reference == null
- `function context` : outer reference == 부모의 lexical 환경(글로벌이나 다른 함수 실행 컨텍스트)
- 함수 안에 선언된 변수는 Environment Record에 저장될 뿐만 아니라, argument에 유사배열객체 안에도 저장됩니다.

### 4.3 Variable Environment

- var로 선언된 식별자들의 값을 저장하는데 사용됩니다.
- Lexical Environment와 비슷하지만 최초 실행시의 스냅샷을 유지한다는 점이 다릅니다.
- 실행 컨텍스트 생성 시 Variable Environment에서 해당 정보를 먼저 담은 다음, 이를 그대로 복사해 Lexical Environment를 생성합니다. Variable Environment는 변하지 않은 채로, 복사한 Lexical Environment 값을 사용하게 됩니다.

### 5 컨텍스트의 생성과 실행

실행 컨텍스트는 두 가지 단계를 거칩니다.

1. 생성단계
1. 실행단계

### 5.1 생성단계

- 글로벌의 생성단계에선 window와 this가 생성됩니다.
- Environment Record에서 변수가 선언될 때, default value로 undefined / unitialized를 갖게 됩니다.
- 변수가 var로 선언되면 undefined, 변수가 let이나 const로 선언되면 unitialized의 값을 가지게 되는데 그렇기 때문에 변수 선언 전에 변수가 사용되면 Reference Error가 뜨게 됩니다.
- 그리고 모든 함수 선언은 전체적으로 메모리에 올라갑니다.

### 5.2 실행단계

- 실행단계에 들어오면, JS 엔진은 한줄한줄 코드를 실행합니다.
- 코드를 실행하면서 이미 메모리에 올라와 선언된 변수들을 값을 할당해줍니다.

![컨텍스트의 생성과 실행](https://miro.medium.com/max/700/1*SBP65hdVDW5j0LuVryTiXw.gif)

### 참고

- [[10분 테코톡] 하루의 실행 컨텍스트](https://www.youtube.com/watch?v=EWfujNzSUmw)
- [실행 컨텍스트](https://velog.io/@deli-ght/%EC%8B%A4%ED%96%89-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8#%EC%8B%A4%ED%96%89-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%9D%98-%EA%B5%AC%EC%A1%B0)

## Dom, 가상 Dom

## 1 DOM(Document Object Model)

웹 페이지나 웹 앱에 있는 HTML 요소들을 구조적으로 표현한 것이다.

## 이벤트 버블링, 이벤트 캡쳐링
